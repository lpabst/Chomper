<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chomper</title>
    <!-- 
        If we release web view in the app, I can very easily make
        a mobile friendly 1-level version!
    -->
</head>

<body>
    <style>
        body {
            background: #222;
        }

        #startLevelText {
            color: #999;
        }

        #newGameButton {
            width: 200px;
            height: 50px;
            margin-bottom: 10px;
            box-shadow: 1px solid black;
        }

        #sectionHeader {
            text-decoration: underline;
        }

        .sectionBox {
            border: 1px solid white;
            padding-left: 10px;
            padding-bottom: 10px;
            color: #999;
            font-size: 15px;
        }

        .subItem {
            margin: 0px;
            padding-left: 20px;
        }

        .hasSubItems {
            margin-bottom: 2px;
        }

        #gameCanvas {
            background: black;
        }
    </style>

    <main>
        <canvas id="gameCanvas"></canvas>
        <div id="hideDuringGameplay">
            <p id="startLevelText">Start Level: <span><input id='gameLevelInput' /></span></p>
            <button id="newGameButton" onclick="Game.init()">Play Campaign</button>
            <button id='playCustomGameButton' onclick="Game.initCustom()">Play Custom Map</button>
            <button id='returnToEditorButton' onclick="drawEverything()">Return To Editor</button>
            <div id="rules" class="sectionBox">
                <h2 id="sectionHeader">How To Play</h2>
                <p>Clicking the 'Play Campaign' button will start the games built in levels. Read down below for info
                    about building your own levels</p>
                <p>Put any level number in the 'Start Level' input to begin playing on that level</p>
                <p>Use the arrow keys to move around. Try and eat the pieces of food on the board for points</p>
                <p>Different food colors are worth different amounts of points. Try and earn as many points as you can
                </p>
                <p>Enemies are red and will chase you. Each enemy has their strength & speed displayed, as do you</p>
                <p>If an emeny catches you, whoever has higher strength wins the fight. Ties go to the enemies</p>
                <p>Losing a fight to an enemy means losing a life. Run out of lives and the game is over</p>
                <p>After losing a life, your player becomes a ghost for a short time, during which you can move through
                    walls, but cannot use warp points or eat food or money </p>
                <p>Sometimes bad guys phase through walls. It's not a bug, it's a feature</p>
                <p>Eating all of the food on a level will take you to the next level</p>
                <p>Every now and then a green piece of food with '$$' written in it will appear for a short time. Eat it
                    for
                    money</p>
                <p>Press the *spacebar* to open and close the shop. Finishing a level will also open up the shop</p>
                <p>Money can be spent in the shop to buy powerups. </p>
                <p>*Note - you can trade your hard earned points for more money & vice-versa. The house always takes a
                    cut
                </p>
                <p>Yours and enemy's movement stops the while shop is open, but the game does not pause, meaning you
                    could
                    miss
                    money appearing while in the shop</p>
                <p>Blinking red dots are warp points that will transport you to stationary red dots. Only you can use
                    warp
                    points</p>
                <p>Food Bonus - if your food bonus is 2 and you eat a food worth 4 points, you will earn 6 points</p>
                <p>See how many points you can end the game with! Have fun</p>
            </div>
            <div id="editorHowTo" class="sectionBox">
                <h2 id="sectionHeader">How To Use The Editor</h2>
                <p>clicking on the map will place whatever the active item is onto the map at that location</p>
                <p>Press 'P' to make the active item the player object</p>
                <p>Press 'E' to make the active item an enemy object</p>
                <p>Press 'M' to make the active item a money object</p>
                <p class="hasSubItems">Press 'O' to make the active item a wall/obstacle object.</p>
                <p class="subItem">Note: you must click twice to build a wall, then it will build the wall between the
                    points you clicked on</p>
                <p class="subItem">Also Note: All walls are straight up/down or left/right, no diagonal walls can be
                    built</p>
                <p class="hasSubItems">Press 'F' to make the active item a food object.</p>
                <p class="subItem">Note: While the active item is food, you can click the numbers to build different
                    point valued food items</p>
                <p class="hasSubItems">Press 'W' to make the active item a warp object</p>
                <p class="subItem">Note: You must click twice to place a warp item. The first click places the entry
                    point, the 2nd click places the exit point</p>
                <p>Click on the 'Play Custom Map' button to try out your level you built!</p>
            </div>
        </div>
    </main>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
        </script>
    <script>
        var canvas=document.getElementById("gameCanvas");canvas.width=500,canvas.height=500;var WALL="WALL",OBSTACLE="OBSTACLE",PLAYER="PLAYER",ENEMY="ENEMY",FOOD="FOOD",MONEYFOOD="MONEYFOOD",HUDTEXT="HUDTEXT",WARP="WARP",LIVES="LIVES",enemyType={NORMAL:"NORMAL",TANK:"TANK",SPEEDY:"SPEEDY",FLOATER:"FLOATER"},hudWalls=[[0,90,150,8,!0],[150,0,8,98,!0]],edgeWalls=[[0,0,canvas.width,8,!0],[0,0,8,canvas.height,!0],[0,canvas.height-8,canvas.width,8,!0],[canvas.width-8,0,8,canvas.height,!0]],entitiesForLevel={1:{playerStartLocation:{x:300,y:400},obstacles:[[33,409,8,49],[34,456,48,8],[5,367,111,8],[39,408,43,8],[79,410,8,47],[115,413,8,78],[48,329,63,8],[48,256,8,73],[51,252,53,8],[47,217,54,8],[44,128,8,85],[44,127,54,8],[47,211,8,10],[141,130,8,239],[103,256,8,76],[95,127,8,91],[150,414,8,75],[156,414,145,8],[187,448,155,8],[337,355,8,91],[377,354,8,96],[381,445,69,8],[417,409,28,8],[445,278,8,133],[411,278,37,8],[411,298,8,111],[415,281,8,22],[300,318,82,8],[300,319,8,62],[244,371,54,8],[140,368,64,8],[183,329,85,8],[182,233,8,94],[183,231,82,8],[214,293,28,8],[214,268,8,27],[214,267,24,8],[235,267,8,27],[265,270,8,24],[269,290,109,8],[412,246,36,8],[446,99,8,148],[412,99,34,8],[410,99,8,145],[371,102,8,188],[370,53,124,8],[264,228,41,8],[305,228,8,32],[312,257,25,8],[187,189,182,8],[186,49,8,140],[186,47,146,8],[332,49,8,139]],enemyLocations:[[275,308,20,2,"NORMAL"],[430,12,20,2,"NORMAL"]],foodLocations:[[15,387,1],[15,414,1],[15,440,1],[16,468,1],[39,470,2],[67,470,2],[95,470,1],[95,443,1],[95,414,1],[95,387,1],[43,386,1],[71,386,1],[131,469,1],[133,444,1],[132,419,1],[96,348,1],[70,347,1],[46,344,1],[23,344,1],[21,315,1],[21,286,1],[21,257,1],[20,207,1],[20,183,1],[21,154,1],[21,127,1],[22,105,2],[46,107,1],[70,106,1],[94,106,1],[122,323,1],[125,301,1],[125,278,1],[123,259,1],[121,207,1],[118,187,1],[117,160,1],[118,132,1],[118,106,1],[59,232,1],[82,232,1],[188,346,1],[160,344,1],[159,310,1],[158,276,1],[158,239,1],[158,207,1],[159,169,1],[159,139,1],[159,108,1],[165,77,2],[167,47,2],[167,21,2],[190,21,3],[214,22,2],[239,20,2],[264,21,2],[290,21,1],[321,21,1],[375,24,1],[403,23,1],[436,23,1],[471,20,1],[352,166,1],[353,130,1],[353,102,1],[353,72,1],[353,44,1],[351,26,1],[427,76,1],[425,259,1],[426,424,1],[469,423,1],[468,390,1],[468,360,1],[467,332,1],[466,299,1],[465,274,1],[465,249,1],[464,223,1],[464,195,1],[465,170,1],[463,145,1],[465,123,1],[465,103,1],[465,78,1],[392,78,1],[392,108,1],[390,139,1],[390,171,1],[390,207,1],[390,237,1],[390,282,1],[392,316,1],[391,360,1],[393,390,1],[394,420,1],[472,450,1],[467,472,1],[436,471,1],[405,471,1],[381,471,1],[326,470,1],[295,470,1],[260,470,1],[226,470,1],[195,471,1],[171,471,1],[168,447,1],[169,428,1],[198,427,1],[227,428,1],[260,429,1],[294,431,1],[319,431,1],[319,374,1],[320,348,1],[360,338,1],[358,370,1],[358,396,2],[357,426,2],[357,451,2],[357,472,2],[133,388,1],[166,388,1],[199,388,1],[244,389,1],[281,390,1],[248,345,1],[276,345,1],[197,307,2],[197,282,2],[195,257,2],[224,249,2],[228,313,2],[250,308,2],[248,275,2],[250,253,2],[280,253,2],[279,271,1],[303,272,1],[348,272,1],[323,272,1],[350,246,1],[349,222,1],[323,239,1],[324,223,1],[293,206,1],[253,205,1],[216,205,1],[189,208,1],[225,355,1],[224,391,1]],moneyItems:[{x:220,y:82,value:20,delayFromStartToShow:5e3,delayFromStartToDie:35e3},{x:130,y:392,value:20,delayFromStartToShow:15e3,delayFromStartToDie:45e3},{x:282,y:82,value:20,delayFromStartToShow:25e3,delayFromStartToDie:55e3},{x:400,y:421,value:20,delayFromStartToShow:35e3,delayFromStartToDie:65e3},{x:224,y:147,value:20,delayFromStartToShow:45e3,delayFromStartToDie:75e3},{x:118,y:234,value:20,delayFromStartToShow:55e3,delayFromStartToDie:85e3}],warpLocations:[{x:357,y:473,exit:{x:307,y:166}},{x:199,y:61,exit:{x:19,y:344}}],testMode:{foodLocations:[[150,387,1]]}},2:{playerStartLocation:{x:64,y:98},obstacles:[[7,147,199,8],[204,11,8,136],[206,152,8,126],[206,277,109,8],[315,277,8,78],[318,355,99,8],[417,361,8,84],[417,445,54,8],[471,451,8,30],[471,480,8,10],[7,185,157,8],[165,228,8,229],[38,226,128,8],[38,269,92,8],[38,275,8,104],[7,409,91,8],[110,277,8,99],[44,370,67,8],[41,451,124,8],[208,325,48,8],[208,332,8,47],[208,368,46,8],[244,331,8,36],[250,348,31,8],[273,385,8,47],[309,407,47,8],[333,432,8,31],[210,407,34,8],[228,420,8,47],[273,459,22,8],[385,429,8,32],[452,405,40,8],[422,373,8,32],[424,359,39,8],[406,320,54,8],[406,250,8,68],[411,249,44,8],[451,247,8,74],[372,250,8,73],[348,312,25,8],[346,248,27,8],[348,249,8,64],[248,238,68,8],[211,202,62,8],[303,40,8,198],[242,171,61,8],[211,131,56,8],[245,86,56,8],[211,48,47,8],[445,207,8,8],[350,205,94,8],[367,82,8,87],[426,77,8,85],[346,33,109,8]],enemyLocations:[[384,88,20,2,"NORMAL"],[287,425,20,.5,enemyType.FLOATER]],foodLocations:[[21,160,2],[42,156,2],[71,159,2],[101,160,2],[129,160,2],[160,160,2],[183,160,2],[17,201,3],[36,199,3],[57,199,3],[85,201,3],[106,200,3],[131,200,3],[154,200,3],[182,199,3],[15,245,4],[142,244,4],[37,241,1],[63,241,1],[91,241,1],[116,241,1],[13,276,2],[15,304,2],[13,330,2],[13,355,2],[12,382,2],[41,384,2],[67,384,2],[99,384,2],[127,383,2],[136,353,2],[136,326,2],[135,296,2],[139,267,2],[143,409,3],[112,410,3],[124,423,4],[82,421,2],[51,422,2],[19,420,2],[17,447,2],[16,474,2],[53,471,2],[86,471,2],[116,470,2],[150,469,2],[185,469,2],[183,428,2],[180,373,2],[178,326,2],[177,277,2],[179,235,2],[220,294,2],[244,292,2],[268,293,2],[292,292,2],[265,319,2],[292,320,2],[257,362,4],[314,417,4],[217,385,2],[207,432,2],[244,429,2],[251,383,2],[290,357,2],[289,387,2],[289,418,2],[355,439,2],[305,450,2],[241,465,2],[349,465,2],[397,466,2],[397,421,2],[393,378,2],[363,399,2],[360,373,2],[326,379,2],[423,460,5],[455,416,5],[431,414,2],[435,380,2],[460,379,2],[471,336,2],[435,333,2],[389,330,2],[346,330,2],[325,296,2],[323,258,2],[279,253,2],[240,252,2],[221,222,2],[261,215,2],[283,190,2],[246,180,2],[219,178,2],[218,139,2],[242,153,2],[240,140,2],[252,154,2],[252,139,2],[262,152,2],[264,135,2],[274,152,2],[276,135,2],[285,109,2],[250,101,2],[220,101,2],[218,64,2],[250,61,2],[278,60,2],[276,25,2],[219,17,4],[244,20,3],[317,16,2],[358,11,1],[389,6,1],[412,12,1],[446,11,1],[469,12,1],[321,48,2],[321,81,2],[321,107,2],[315,146,2],[319,175,2],[319,208,2],[352,221,2],[386,222,2],[426,217,2],[462,219,2],[467,257,2],[470,294,2],[358,179,2],[388,179,2],[428,174,2],[459,174,2],[392,142,3],[389,112,3],[392,82,3],[455,139,2],[453,96,2],[456,54,2],[362,48,4],[415,46,4]],moneyItems:[{x:135,y:312,value:20,delayFromStartToShow:5e3,delayFromStartToDie:35e3},{x:285,y:311,value:20,delayFromStartToShow:15e3,delayFromStartToDie:45e3},{x:392,y:226,value:20,delayFromStartToShow:25e3,delayFromStartToDie:55e3},{x:272,y:102,value:20,delayFromStartToShow:35e3,delayFromStartToDie:65e3},{x:26,y:427,value:20,delayFromStartToShow:45e3,delayFromStartToDie:75e3},{x:360,y:466,value:20,delayFromStartToShow:55e3,delayFromStartToDie:85e3},{x:189,y:128,value:20,delayFromStartToShow:65e3,delayFromStartToDie:95e3}],warpLocations:[{x:14,y:159,exit:{x:18,y:109}},{x:170,y:137,exit:{x:449,y:470}},{x:196,y:109,exit:{x:480,y:425}},{x:396,y:60,exit:{x:163,y:13}}],testMode:{enemyLocations:[[384,88,20,2,"NORMAL"]],foodLocations:[[21,160,2]]}},3:{playerStartLocation:{x:225,y:197},obstacles:[[136,228,215,8],[138,279,211,8],[81,149,8,215],[7,244,39,8],[42,100,8,100],[42,298,8,135],[49,427,308,8],[170,323,8,57],[213,323,8,52],[257,320,8,55],[310,322,8,56],[126,322,8,49],[136,180,210,8],[155,35,125,8],[331,8,8,74],[197,80,134,8],[141,134,196,8],[349,323,8,50],[371,34,8,68],[374,34,81,8],[452,40,8,58],[374,94,78,8],[391,140,8,226],[395,140,59,8],[442,140,8,225],[395,355,47,8],[390,408,8,52],[391,456,65,8],[451,406,8,50],[391,406,60,8],[125,369,8,13],[81,363,8,16]],enemyLocations:[[95,194,8,3.5,enemyType.SPEEDY],[358,194,8,3.5,enemyType.SPEEDY],[226,391,95,1.3,enemyType.TANK],[224,46,100,1.2,enemyType.TANK],[409,108,115,1.1,enemyType.TANK],[407,368,150,1,enemyType.TANK],[14,209,85,1.4,enemyType.TANK],[11,264,50,1,enemyType.FLOATER],[92,454,100,1.2,enemyType.TANK],[332,455,100,1.2,enemyType.TANK]],foodLocations:[[139,200,3],[166,196,3],[198,196,3],[267,198,3],[305,197,3],[337,195,3],[138,251,4],[168,249,4],[197,249,4],[230,251,4],[264,249,4],[297,249,4],[335,249,4],[136,155,4],[162,156,4],[192,155,4],[216,153,4],[247,151,4],[282,151,4],[321,153,4],[144,343,5],[187,342,5],[233,341,5],[281,340,5],[330,341,5],[14,117,6],[184,11,6],[17,269,3],[16,300,3],[12,341,3],[16,380,3],[16,420,3],[17,454,3],[54,454,3],[103,457,3],[142,454,3],[192,453,3],[228,456,3],[284,449,3],[334,452,3],[366,454,3],[365,454,3],[390,459,3],[411,472,3],[446,472,3],[472,471,3],[471,430,3],[468,378,3],[431,374,3],[388,375,3],[367,414,3],[367,374,3],[323,399,3],[274,399,3],[210,399,3],[140,393,3],[98,395,3],[58,397,3],[56,356,3],[56,318,3],[55,278,3],[55,247,3],[57,211,3],[20,211,3],[17,179,3],[58,177,3],[17,145,3],[62,138,3],[62,111,3],[368,335,3],[364,291,3],[365,254,3],[365,200,3],[363,161,3],[363,118,3],[391,119,3],[425,118,3],[465,116,3],[470,174,3],[470,233,3],[469,279,3],[469,333,3],[470,77,3],[467,35,3],[427,16,3],[375,14,3],[346,19,3],[347,59,3],[332,103,3],[287,101,3],[232,100,3],[181,98,3],[175,57,3],[221,57,3],[274,57,3],[308,52,3],[304,14,3],[270,14,3],[224,11,3],[104,110,3],[110,155,3],[99,213,3],[106,249,3],[105,281,3],[102,324,3],[174,393,3]],moneyItems:[{x:110,y:151,value:20,delayFromStartToShow:5e3,delayFromStartToDie:35e3},{x:475,y:57,value:20,delayFromStartToShow:15e3,delayFromStartToDie:45e3},{x:292,y:50,value:20,delayFromStartToShow:25e3,delayFromStartToDie:55e3},{x:58,y:240,value:20,delayFromStartToShow:35e3,delayFromStartToDie:65e3},{x:60,y:404,value:20,delayFromStartToShow:45e3,delayFromStartToDie:75e3},{x:294,y:456,value:20,delayFromStartToShow:55e3,delayFromStartToDie:85e3},{x:468,y:375,value:20,delayFromStartToShow:65e3,delayFromStartToDie:95e3},{x:325,y:202,value:20,delayFromStartToShow:75e3,delayFromStartToDie:105e3}],warpLocations:[{x:21,y:105,exit:{x:221,y:18}},{x:163,y:14,exit:{x:21,y:146}}],testMode:{enemyLocations:[[226,391,95,1.3,enemyType.TANK]],foodLocations:[[139,200,3]]}}};function random(e,t,i){var n=i?1:0;return Math.floor(Math.random()*(t-e+n))+e}function hudCheck(e,t){var i=hudWalls[1][0],n=hudWalls[1][3];!t&&e.x<i&&e.y<n&&(console.warn("In the HUD area"),console.log(e))}function removeFromArrayById(e,t){for(var i=e.length-1;i>=0;i--)if(e[i].id===t)return void e.splice(i,1)}var Input={init:function(e){this.setMovementKeys(e),this.setMenuKeys(e)},setMovementKeys:function(e){e.eventListeners.handleKeyDown=function(){event.keyCode>=37&&event.keyCode<=40&&event.preventDefault(),Input.helpers.down[event.keyCode]=!0},e.eventListeners.handleKeyUp=function(){delete Input.helpers.down[event.keyCode],delete Input.helpers.pressed[event.keyCode]},$(window).on("keydown",e.eventListeners.handleKeyDown),$(window).on("keyup",e.eventListeners.handleKeyUp)},allMovementKeysUp:function(e){delete Input.helpers.down[37],delete Input.helpers.pressed[37],delete Input.helpers.down[38],delete Input.helpers.pressed[38],delete Input.helpers.down[39],delete Input.helpers.pressed[39],delete Input.helpers.down[40],delete Input.helpers.pressed[40]},setMenuKeys:function(e){e.eventListeners.handleKeyPress=function(){32===event.keyCode&&(event.preventDefault(),Input.allMovementKeysUp(e),e.gameRunning=!e.gameRunning),e.gameRunning||Input.handleShopPurchases(e,event)},$(window).on("keypress",e.eventListeners.handleKeyPress)},handleShopPurchases(e,t){if(!e.gameOver){var i=e.shopItems[t.code];if(i){var n=e.entities.player,o=n[i.costType];if(o<i.cost)return alert("You dont have enough "+i.costType+" for that item. \nCost: "+i.cost+" \nYou have "+o);var a=JSON.parse(JSON.stringify(i));for(var s in a[i.costType]=-1*a.cost,delete a.cost,delete a.costType,delete a.costIncrease,a)n[s]+=a[s];i.cost=Math.floor(i.cost*i.costMultiplier),Game.showMenu(e)}}},update:function(e){var t=e.entities.player,i=Input.helpers.isDown(37),n=Input.helpers.isDown(39),o=Input.helpers.isDown(38),a=Input.helpers.isDown(40);t.direction={left:!1,up:!1,right:!1,down:!1},i&&(t.x-=t.velX,t.direction.left=!0),n&&(t.x+=t.velX,t.direction.right=!0),o&&(t.y-=t.velY,t.direction.up=!0),a&&(t.y+=t.velY,t.direction.down=!0)},helpers:{isDown:function(e){return Input.helpers.down[e]},isPressed:function(e){return!Input.helpers.pressed[e]&&(!!Input.helpers.down[e]&&(Input.helpers.pressed[e]=!0))},down:{},pressed:{}}},Entities={init:function(e){var t=new Entities.helpers.player;e.entities={background:{x:0,y:0,w:1e3,h:800},player:t,wallsArray:[],enemiesArray:[],foodArray:[]},hudWalls.concat(edgeWalls).forEach(function(t){var i=new Entities.helpers.Wall(t[0],t[1],t[2],t[3],WALL);hudCheck(i,t[4]),e.entities.wallsArray.push(i)})},clearLevelSpecificEntities:function(e){e.entities.enemiesArray=[],e.entities.foodArray=[],e.entities.moneyArray=[],e.entities.warpArray=[];var t=[];e.entities.wallsArray.forEach(function(e){e.wallType===WALL&&t.push(e)}),e.entities.wallsArray=t},initLevelSpecificEntities:function(e){this.clearLevelSpecificEntities(e),entitiesForLevel[e.gameLevel]||(e.gameLevel=1,e.gameLevelResets++);var t=entitiesForLevel[e.gameLevel];if(e.testMode)for(var i in t.testMode)t[i]=t.testMode[i];e.playCustomMap&&(t=e.customEntities),e.entities.player.x=t.playerStartLocation.x,e.entities.player.y=t.playerStartLocation.y,t.obstacles.forEach(function(t){var i=new Entities.helpers.Wall(t[0],t[1],t[2],t[3],OBSTACLE);hudCheck(i,t[4]),e.entities.wallsArray.push(i)}),t.enemyLocations.forEach(function(t){var i=new Entities.helpers.Enemy(t[0],t[1],t[2],t[3],t[4]);hudCheck(i),e.entities.enemiesArray.push(i)}),t.foodLocations.forEach(function(t){var i=new Entities.helpers.Food(t[0],t[1],t[2]);hudCheck(i),e.entities.foodArray.push(i)}),t.moneyItems.forEach(function(t){var i=new Entities.helpers.MoneyFood(t);hudCheck(i),e.entities.moneyArray.push(i)}),t.warpLocations.forEach(function(t){var i=new Entities.helpers.Warp(t.exit);t.exit=i;var n=new Entities.helpers.Warp(t);hudCheck(n),hudCheck(n.exit),e.entities.warpArray.push(n)}),e.gameLevelResets>0&&e.entities.enemiesArray.forEach(function(t){t.speed+=e.gameLevelResets,t.strength+=100*e.gameLevelResets,t.speed>8&&(t.speed=8)})},update:function(e){e.entities.player.update(e),e.entities.enemiesArray.forEach(function(t){t.update(e)}),e.entities.moneyArray.forEach(function(t){t.update(e)})},helpers:{player:function(){this.type=PLAYER,this.points=0,this.x=100,this.y=100,this.w=20,this.h=20,this.color="white",this.direction="right",this.velY=3,this.velX=3,this.speed=2,this.lives=3,this.strength=5,this.inGhostState=!1,this.enteredGhostStateTimestamp=null,this.ghostStateDuration=5e3,this.money=40,this.foodPointsIncrementer=0,this.text=function(){return[this.strength,Math.floor(100*this.speed)]},this.update=function(e){this.color="white",this.resetVelocities(e),this.handleGhostStateIfNecessary(e)},this.resetVelocities=function(e){this.velX=this.speed,this.velY=this.speed},this.handleGhostStateIfNecessary=function(e){this.inGhostState&&(this.color="gray",e.animationFrame%8==0&&(this.color="black"),(new Date).getTime()-this.enteredGhostStateTimestamp>this.ghostStateDuration&&(this.inGhostState=!1,this.enteredGhostStateTimestamp=null))}},Wall:function(e,t,i,n,o=OBSTACLE){this.x=e,this.y=t,this.w=i,this.h=n,this.color="white",this.type=WALL,this.wallType=o},Food:function(e,t,i){this.getColor=function(){return{1:"#00f",2:"#0f0",3:"#cc2",4:"#f5f",5:"#0ff",6:"#0f6",7:"#ff0",8:"#550",9:"#992"}[this.value]},this.id=random(1e5,1e9),this.x=e||random(0,data.canvas.width),this.y=t||random(0,data.canvas.height),this.w=12,this.h=12,this.size="15px",this.font="Arial",this.value=i,this.color=this.getColor(),this.type=FOOD,this.text=function(){return[this.value]}},Enemy:function(e,t,i,n,o="normal"){this.id=random(1e5,1e9),this.x=e,this.y=t,this.color="red",this.type=ENEMY,this.enemyType=o,this.speed=n,this.size=20,this.w=this.size,this.h=this.size,this.strength=i,this.frozen=!1,this.frozenTimestamp=null,this.text=function(){return[this.strength,Math.floor(100*this.speed)]},this.update=function(e){if(this.frozen){(new Date).getTime()-this.frozenTimestamp>1e3*this.speed&&(this.frozen=!1,this.frozenTimestamp=null)}else{var t=e.entities.player,i="FLOATER"===this.enemyType,n=5-this.speed;if(n<1&&(n=1),t.x<=this.x){var o=this.x-this.speed;(i||!l(o,o,this.y,this.y+this.h,n))&&(this.x-=this.speed)}if(t.x>=this.x){var a=this.x+this.w+this.speed;(i||!l(a,a,this.y,this.y+this.h,n))&&(this.x+=this.speed)}if(t.y<=this.y){var s=this.y-this.speed;(i||!l(this.x,this.x+this.w,s,s,n))&&(this.y-=this.speed)}if(t.y>=this.y){var r=this.y+this.h+this.speed;(i||!l(this.x,this.x+this.w,r,r,n))&&(this.y+=this.speed)}}function l(t,i,n,o,a){var s=0,r=0;i-t>8&&(s=Math.floor(a)),o-n>8&&(r=Math.floor(a)),t=Math.floor(t),i=Math.floor(i),n=Math.floor(n),o=Math.floor(o);for(var l=t+s;l<=i-s;l++)for(var h=n+r;h<=o-r;h++){var d=l+"|"+h;if(e.wallsCache[d])return!0}return!1}}},MoneyFood:function(e){this.id=random(1e5,1e9),this.type=MONEYFOOD,this.x=e.x,this.y=e.y,this.value=e.value,this.delayFromStartToShow=e.delayFromStartToShow,this.delayFromStartToDie=e.delayFromStartToDie,this.w=13,this.h=13,this.color="green",this.alive=!1,this.text=function(){return["$$"]},this.update=function(e){var t=(new Date).getTime()-e.gameLevelStartTime;if(t>this.delayFromStartToShow&&t<this.delayFromStartToDie?this.alive=!0:this.alive=!1,this.alive){var i=this.delayFromStartToDie-this.delayFromStartToShow,n=t-this.delayFromStartToShow,o=Math.floor(100*(i-n/i));e.animationFrame%o==0?this.color="black":this.color="green"}}},HUDText:function(e,t){this.x=10,this.y=e,this.value=t,this.size="20px",this.font="Arial",this.color="green",this.type=HUDTEXT},Warp:function(e){this.type=WARP,this.size=5,this.w=this.size,this.h=this.size,this.color="#f00",this.x=e.x,this.y=e.y,this.exit=e.exit?e.exit:null}}},Render={init:function(e){Render.helpers.drawEntity(e.entities.background)},update:function(e){this.clearCanvas(e.canvas);var t=new Entities.helpers.HUDText(27,"Level: "+e.gameLevel),i=new Entities.helpers.HUDText(46,"Points: "+e.entities.player.points),n=new Entities.helpers.HUDText(64,"Lives: "+e.entities.player.lives),o=new Entities.helpers.HUDText(82,"Food Bonus: "+e.entities.player.foodPointsIncrementer);for(var a in Render.helpers.drawText(t),Render.helpers.drawText(i),Render.helpers.drawText(n),Render.helpers.drawText(o),e.entities)Array.isArray(e.entities[a])&&e.entities[a].forEach(function(t){if(t.type===WARP){if(e.animationFrame%2==0){var i={0:t.size,1:.7*t.size,2:.4*t.size}[e.animationFrame%3];t.r=i}Render.helpers.drawCircle(t),t.exit.r=t.exit.size,Render.helpers.drawCircle(t.exit)}else t.type===MONEYFOOD?t.alive&&Render.helpers.drawEntity(t):Render.helpers.drawEntity(t)});Render.helpers.drawEntity(e.entities.player)},clearCanvas:function(e){if(!e){var t=document.getElementById("gameCanvas");e={canvas:t,context:t.getContext("2d")}}e.context.clearRect(0,0,e.canvas.width,e.canvas.height)},helpers:{drawEntity:function(e,t,i){if(t||(t=document.getElementById("gameCanvas").getContext("2d")),i||"string"!=typeof t||(i=t,t=document.getElementById("gameCanvas").getContext("2d")),t.fillStyle=i||(e.color?e.color:"white"),t.fillRect(e.x,e.y,e.w,e.h),e.text){var n=e.text();t.fillStyle="black",t.font="bold 10px Arial";var o=e.x+1,a=e.y;n.forEach(function(e){a+=9,t.fillText(e,o,a)})}},drawText:function(e,t){t||(t=document.getElementById("gameCanvas").getContext("2d")),e.font||(e.font="Arial"),e.color||(e.color="white"),e.size||(e.size="14px"),t.font=e.size+" "+e.font,t.fillStyle=e.color,t.fillText(e.value,e.x,e.y)},drawCircle:function(e,t){t||(t=document.getElementById("gameCanvas").getContext("2d")),t.fillStyle=e.color?e.color:"white",t.beginPath(),t.arc(e.x,e.y,e.r,0,2*Math.PI),t.closePath(),t.fill()}}},Physics={update:function(e){Physics.collisionDetection(e)},collisionDetection:function(e){var t=e.entities.player;function i(i){var n=i.x,o=i.x+i.w,a=i.y,s=i.y+i.h;if(i.type===WARP){var r=i.size/2;n-=r,o-=r,a-=r,s-=r}t.x<o&&t.x+t.w>n&&t.y<s&&t.y+t.h>a&&Physics.handlePlayerCollision(e,i)}function n(t,i){t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.h&&t.y+t.h>i.y&&Physics.handleEnemyWallCollision(e,t,i)}for(var o in e.entities)Array.isArray(e.entities[o])&&e.entities[o].forEach(function(t){i(t),t.type===ENEMY&&e.entities.wallsArray.forEach(function(e){n(t,e)})})},handleEnemyWallCollision(e,t,i){},handlePlayerCollision(e,t){var i=e.entities.player,n=i.x,o=i.x+i.w,a=i.y,s=i.y+i.h,r=t.type===WALL&&t.wallType===WALL;if(!i.inGhostState||r){if(t.type===FOOD){var l=t.value+e.entities.player.foodPointsIncrementer;e.entities.player.points+=l,removeFromArrayById(e.entities.foodArray,t.id),0===e.entities.foodArray.length&&(e.startNextLevel=!0)}if(t.type===MONEYFOOD&&t.alive){var h=t.value;e.entities.player.money+=h,removeFromArrayById(e.entities.moneyArray,t.id)}if(t.type===WALL){var d=t.x,y=t.x+t.w,c=t.y,p=t.y+t.h,m=i.speed;!i.direction.right&&n>d&&n<y&&o>y&&a<p-m&&s>c+m&&(i.velX=0),!i.direction.left&&o>d&&o<y&&n<d&&a<p-m&&s>c+m&&(i.velX=0),!i.direction.down&&a>c&&a<p&&s>p&&n<y-m&&o>d+m&&(i.velY=0),!i.direction.up&&s>c&&s<p&&a<c&&n<y-m&&o>d+m&&(i.velY=0)}if(t.type===WARP){var w=i.w/2;i.x=t.exit.x-w,i.y=t.exit.y-w}if(t.type===ENEMY)if(i.strength>t.strength)removeFromArrayById(e.entities.enemiesArray,t.id),i.points+=t.strength;else{if(i.lives--,i.inGhostState=!0,i.enteredGhostStateTimestamp=(new Date).getTime(),i.lives<1)return e.gameOver=!0,e.gameRunning=!1,Game.handleHighScore(i.points);e.entities.enemiesArray.forEach(function(e){e.frozen=!0,e.frozenTimestamp=(new Date).getTime()})}}}},Game={initCustom:function(){foodLocations.length<1||!playerStartLocation||Game.init({playCustomMap:!0,gameLevel:1,customEntities:{playerStartLocation:playerStartLocation,obstacles:obstacles,foodLocations:foodLocations,enemyLocations:enemyLocations,warpLocations:warpLocations,moneyItems:moneyItems}})},init:function(e){e||(e={}),document.getElementById("hideDuringGameplay").style.display="none";var t=document.getElementById("gameLevelInput"),i=Number(t.value),n=1;entitiesForLevel[i]&&(n=i);var o=document.getElementById("gameCanvas"),a=o.getContext("2d"),s={animationFrame:0,canvas:{canvas:o,context:a},gameOver:!1,gameRunning:!0,gameLevel:n,gameLevelStartTime:(new Date).getTime(),gameLevelResets:0,shopItems:this.buildShop(),eventListeners:{}};e.testMode&&(s.testMode=!0),e.playCustomMap&&(s.playCustomMap=e.playCustomMap,s.customEntities=e.customEntities,s.gameLevel=e.gameLevel),Entities.init(s),Input.init(s),Render.init(s),Game.initLevel(s),Game.run(s)},initLevel(e){e.playCustomMap&&1!==e.gameLevel&&(e.gameOver=!0),Entities.initLevelSpecificEntities(e),e.wallsCache=this.buildWallsCache(e)},run:function(e){window.gameLoopRunning=!0;var t=function(){if(e.gameOver)return window.gameLoopRunning=!1,void Game.handleGameOver(e);e.startNextLevel&&(e.startNextLevel=!1,e.gameRunning=!1,setTimeout(function(){e.gameLevel++,e.gameLevelStartTime=(new Date).getTime(),Game.initLevel(e)},1)),e.gameRunning&&!e.buildingLevel?(Game.input(e),Game.update(e),Game.render(e)):Game.showMenu(e),e.animationFrame++,window.requestAnimationFrame(t)};t()},input:function(e){Input.update(e)},update:function(e){Entities.update(e),Physics.update(e)},render:function(e){Render.update(e)},buildShop:function(){return{KeyO:{cost:25,costMultiplier:1,costType:"money",points:4},KeyP:{cost:50,costMultiplier:1,costType:"money",points:9},KeyK:{cost:4,costMultiplier:1,costType:"points",money:20},KeyL:{cost:8,costMultiplier:1,costType:"points",money:42},KeyQ:{cost:10,costMultiplier:1.5,costType:"money",strength:1},KeyW:{cost:10,costMultiplier:1.5,costType:"money",speed:.05},KeyE:{cost:100,costMultiplier:1.2,costType:"money",lives:1},KeyR:{cost:500,costMultiplier:2,costType:"money",foodPointsIncrementer:1}}},buildWallsCache:function(e){for(var t={},i=0;i<e.entities.wallsArray.length;i++)for(var n=e.entities.wallsArray[i],o=n.x;o<=n.x+n.w;o++)for(var a=n.y;a<=n.y+n.h;a++){t[o+"|"+a]=!0}return t},handleGameOver(e){if(document.getElementById("hideDuringGameplay").style.display="block",$(window).off("keydown",e.eventListeners.handleKeyDown),$(window).off("keyup",e.eventListeners.handleKeyUp),$(window).off("keypress",e.eventListeners.handleKeyPress),Input.allMovementKeysUp(),e.playCustomMap)return window.wall=!0,drawEverything();var t={x:.25*e.canvas.canvas.width,y:.25*e.canvas.canvas.height,w:e.canvas.canvas.width/2,h:e.canvas.canvas.height/2,color:"#222"},i={x:t.x+10,y:t.y+50,size:"30px",color:"white",value:"Game Over"},n={x:i.x,y:i.y+30,size:"26px",value:"Final Score: "+e.entities.player.points};Render.helpers.drawEntity(t),Render.helpers.drawText(i),Render.helpers.drawText(n);var o=this.getLocalHighScoreInfo(),a=o.savedHighScore,s=o.savedScoreValidation,r=(this.validateHighScore(a,s),{x:n.x,y:n.y+22,value:"Game Identifier: "}),l={x:r.x,y:r.y+20,value:random(1e5,999999)+"-"+s+"-"+random(1e5,999999)},h={x:l.x,y:l.y+40,value:"High Score: "+a};Render.helpers.drawText(r),Render.helpers.drawText(l),Render.helpers.drawText(h)},getLocalHighScoreInfo:()=>({savedHighScore:localStorage.highScore?localStorage.highScore:0,savedScoreValidation:localStorage.scoreValidation?localStorage.scoreValidation:0}),handleHighScore(e){try{var t=this.getLocalHighScoreInfo(),i=t.savedHighScore,n=t.savedScoreValidation;(!this.validateHighScore(i,n)||e>i)&&(localStorage.highScore=e,localStorage.scoreValidation=this.createScoreValidation(e))}catch(e){console.log("Problem saving high score"),console.log(e)}},createScoreValidation(e){if(!e)return random(111111,999999);for(var t=e.toString(),i=0,n=btoa(t+t),o=0;o<n.length;o++){i=(i<<5)-i+n.charCodeAt(o),i&=i}return i},validateHighScore(e,t){var i=Game.createScoreValidation(e);return(i=i.toString())===(t=t.toString())},showMenu(e){Render.clearCanvas(e.canvas),Render.helpers.drawText({x:e.canvas.canvas.width/2-80,y:50,size:"25px",value:"Shop!!!"}),Render.helpers.drawText({x:e.canvas.canvas.width-120,y:55,value:"You"}),Render.helpers.drawText({x:e.canvas.canvas.width-120,y:80,value:"Points: "+e.entities.player.points}),Render.helpers.drawText({x:e.canvas.canvas.width-120,y:100,value:"Money: $"+e.entities.player.money}),Render.helpers.drawText({x:e.canvas.canvas.width-120,y:120,value:"Strength: "+e.entities.player.strength}),Render.helpers.drawText({x:e.canvas.canvas.width-120,y:140,value:"Speed: "+Math.round(100*e.entities.player.speed)}),Render.helpers.drawText({x:20,y:80,value:"O: Trade $25 for 4 points"}),Render.helpers.drawText({x:20,y:100,value:"P: Trade $50 for 9 points"}),Render.helpers.drawText({x:20,y:120,value:"K: Trade 4 points for $20"}),Render.helpers.drawText({x:20,y:140,value:"L: Trade 8 points for $42"}),Render.helpers.drawText({x:20,y:210,value:"Q: Strength Potion - "+e.shopItems.KeyQ.strength+" strength - $"+e.shopItems.KeyQ.cost}),Render.helpers.drawText({x:20,y:235,value:"W: Speed Potion - "+100*e.shopItems.KeyW.speed+" speed - $"+e.shopItems.KeyW.cost}),Render.helpers.drawText({x:20,y:260,value:"E: Extra Life - "+e.shopItems.KeyE.lives+" life - $"+e.shopItems.KeyE.cost}),Render.helpers.drawText({x:20,y:285,value:"R: Increase food point values by "+e.shopItems.KeyR.foodPointsIncrementer+" - $"+e.shopItems.KeyR.cost})}};window.wall=!0;var playerStartLocation={},obstacles=[],foodLocations=[],foodValue=1,enemyLocations=[],moneyItems=[],moneyStartTime=5e3,warpLocations=[];function drawEverything(){window.gameLoopRumning||(Render.clearCanvas(),hudWalls.concat(edgeWalls).forEach(function(e){var t=new Entities.helpers.Wall(e[0],e[1],e[2],e[3],WALL);Render.helpers.drawEntity(t)}),obstacles.forEach(function(e){var t=new Entities.helpers.Wall(e[0],e[1],e[2],e[3],OBSTACLE);Render.helpers.drawEntity(t)}),foodLocations.forEach(function(e){var t=new Entities.helpers.Food(e[0],e[1],e[2]);Render.helpers.drawEntity(t)}),enemyLocations.forEach(function(e){var t=new Entities.helpers.Enemy(e[0],e[1],e[2],e[3],e[4]);Render.helpers.drawEntity(t)}),moneyItems.forEach(function(e){var t=new Entities.helpers.MoneyFood(e);Render.helpers.drawEntity(t)}),warpLocations.forEach(function(e){var t=new Entities.helpers.Warp(e.exit),i=new Entities.helpers.Warp(e);i.r=i.size,t.r=t.size,i.exit=t,Render.helpers.drawCircle(i),Render.helpers.drawCircle(t)}),window.playerObj&&Render.helpers.drawEntity(window.playerObj))}function copyObstacles(){var e=JSON.stringify(obstacles);console.log(e)}function copyFood(){var e=JSON.stringify(foodLocations);console.log(e)}function copyEnemies(){var e=JSON.stringify(enemyLocations);console.log(e)}function copyMoney(){console.log(JSON.stringify(moneyItems))}function copyWarps(){console.log(JSON.stringify(warpLocations))}function startFromSave(e){window.playerObj=new Entities.helpers.player(e.playerStartLocation),obstacles=e.obstacles,enemyLocations=e.enemyLocations,foodLocations=e.foodLocations,moneyItems=e.moneyItems,warpLocations=e.warpLocations,drawEverything()}drawEverything(),$(window).on("keypress",function(e){if(!window.gameLoopRunning){if("KeyT"===e.code?(window.timesTPressed||(window.timesTPressed=0),window.timesTPressed++,window.timesTPressed>=3&&(window.timesTPressed=0,Game.init({testMode:!0}))):window.timesTPressed=0,"KeyC"===e.code?(window.timesCPressed||(window.timesCPressed=0),window.timesCPressed++,window.timesCPressed>=3&&Game.initCustom()):window.timesCPressed=0,e.keyCode>=49&&e.keyCode<=57&&window.food)return window.foodValue=Number(e.key);var t={KeyE:"enemy",KeyF:"food",KeyW:"warp",KeyO:"wall",KeyM:"money",KeyP:"player"};for(var i in t)window[t[i]]=!1;var n=t[e.code];window[n]=!0}}),$("#gameCanvas").on("click",function(e){var t=[e.offsetX,e.offsetY];if(window.player&&(t[0]-=10,t[1]-=10,window.playerObj||(window.playerObj=new Entities.helpers.player),window.playerObj.x=t[0],window.playerObj.y=t[1],playerStartLocation={x:t[0],y:t[1]},console.log(t)),window.food&&(t[0]-=6,t[1]-=6,t.push(window.foodValue),foodLocations.push(t)),window.enemy&&(t[0]-=10,t[1]-=10,t.push(20,2,enemyType.NORMAL),enemyLocations.push(t)),window.warp&&(t[0]-=1,t[1]-=1,window.beginWarpPoint?(warpLocations.push({x:window.beginWarpPoint[0],y:window.beginWarpPoint[1],exit:{x:t[0],y:t[1]}}),window.beginWarpPoint=null):window.beginWarpPoint=t),window.money&&(t[0]-=4,t[1]-=4,moneyItems.push({x:t[0],y:t[1],value:20,delayFromStartToShow:moneyStartTime,delayFromStartToDie:moneyStartTime+3e4}),moneyStartTime+=1e4),window.wall)if(window.beginPoint){if(window.beginPoint[0]>t[0]){var i=window.beginPoint[0];window.beginPoint[0]=t[0],t[0]=i}if(window.beginPoint[1]>t[1]){i=window.beginPoint[1];window.beginPoint[1]=t[1],t[1]=i}var n=t[0]-window.beginPoint[0],o=t[1]-window.beginPoint[1];n>o?o=8:n=8,window.beginPoint.push(n,o),obstacles.push(window.beginPoint),window.beginPoint=null}else window.beginPoint=t;drawEverything()});
    </script>

</body>

</html>